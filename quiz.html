<!DOCTYPE html>
<html>
<head>
  <title>Quiz App</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* New Timer Bar Styles */
    .timer-container {
      width: 100%;
      height: 20px;
      background: #eee;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
    }
    .timer-progress {
      height: 100%;
      background: #4CAF50;
      width: 100%;
      transition: width 1s linear;
    }
    .timer-text {
      position: absolute;
      right: 10px;
      top: 0;
      color: #333;
      font-weight: bold;
    }

    /* Existing styles with minor adjustments */
    .quiz-header-bar {
      margin-top: 40px; /* Added space for fixed timer */
    }
    /* Keep all other existing styles */
  </style>
</head>
<body>
  <!-- New Timer Bar -->
  <div class="timer-container">
    <div class="timer-progress" id="timerProgress"></div>
    <div class="timer-text" id="timerText">00:00</div>
  </div>

  <!-- Rest of your existing HTML remains the same -->
  <div id="loading">Checking authentication...</div>
  <div class="app" style="display:none; position: relative;">
    <div class="quiz-header-bar">
      <div class="quiz-index-bar" id="quizIndexBar"></div>
    </div>
    <div class="quiz">
      <h2 id="question">Question will appear here</h2>
      <div id="answer-buttons"></div>
      <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
        <button id="next-btn">Next</button>
        <button id="skip-btn">Skip</button>
        <button id="submit-btn">Submit Quiz</button>
      </div>
      <div id="result"></div>
    </div>
  </div>

  <!-- Firebase Auth Script (same as before) -->

  <!-- Main Quiz Logic with Critical Fixes -->
  <script>
    // Add this variable to track answered questions
    let questionAnswered = false;

    function showQuestion() {
      if (quizEnded) return;
      questionAnswered = false; // Reset for new question
      nextBtn.style.display = 'none';
      questionElem.textContent = questions[currentIndex].question;
      answersDiv.innerHTML = "";

      questions[currentIndex].answers.forEach(answer => {
        const btn = document.createElement("button");
        btn.textContent = answer.text;
        btn.classList.add("answer-btn");
        btn.onclick = () => {
          if (!questionAnswered) selectAnswer(btn, answer.correct);
        };
        answersDiv.appendChild(btn);
      });

      updateIndexBar();
    }

    function selectAnswer(selectedBtn, isCorrect) {
      if (quizEnded || questionAnswered) return;
      questionAnswered = true; // Prevent multiple answers

      const q = questions[currentIndex];
      const allBtns = answersDiv.querySelectorAll('button');
      allBtns.forEach(btn => btn.disabled = true);

      // Score calculation remains same but protected by questionAnswered check
      if (isCorrect) {
        score += 1;
        selectedBtn.classList.add('correct');
      } else {
        score -= 1 / 3;
        selectedBtn.classList.add('wrong');
        allBtns.forEach(btn => {
          if (btn.textContent === q.answers.find(a => a.correct).text) {
            btn.classList.add('correct');
          }
        });
      }
      
      // Cap score at max possible for attempted questions
      score = Math.min(score, questions.length);
      nextBtn.style.display = 'inline-block';
      skipBtn.style.display = 'inline-block';
      updateIndexBar();
    }

    // Modified Timer Function
    function startTimer() {
      let remaining = quizDuration;
      const maxWidth = 100; // 100% width
      
      timerInterval = setInterval(() => {
        const minutes = String(Math.floor(remaining / 60)).padStart(2, "0");
        const seconds = String(remaining % 60).padStart(2, "0");
        
        // Update progress bar
        const progressPercent = (remaining / quizDuration) * 100;
        document.getElementById('timerProgress').style.width = `${progressPercent}%`;
        document.getElementById('timerText').textContent = `${minutes}:${seconds}`;

        if (remaining <= 0) {
          clearInterval(timerInterval);
          endQuiz();
        }
        remaining--;
      }, 1000);
    }
  </script>
</body>
</html>
